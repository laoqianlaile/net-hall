var os=function(){var e=navigator.userAgent,a=/(?:Windows Phone)/.test(e),t=/(?:SymbianOS)/.test(e)||a,s=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),n=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||s&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e)),o=/(?:iPhone)/.test(e)&&!n,l=!o&&!s&&!t;return{isTablet:n,isPhone:o,isAndroid:s,isPc:l}}();os.isAndroid||os.isPhone?window.top.location.href=$("meta[name=contexPath]").attr("content")+"/common/mobile/app.html":os.isTablet?window.top.location.href=$("meta[name=contexPath]").attr("content")+"/common/mobile/app.html":os.isPc;var poolSelect=pageData.poolSelect||{},userConfig=pageData.userConfig||{},strCertId=pageData.strCertId||"null";!function(){var e="true"==poolSelect._HIDE_PERSON_INFO?"container-fluid userhide":"container-fluid";document.getElementById("page_wrap").setAttribute("class",e),$(".home-logo-type").addClass("home-logo-"+(poolSelect._LONGINTYPE||"")),$("#asideHome a").attr("href",ydl.contexPath+"/home"),$(".user-name").text(pageData._OPERNAME||"未登录").attr("title",pageData._OPERNAME||"未登录"),$("#systemExit").attr("href",ydl.contexPath+"/logout/"+(poolSelect._OPERID||"nologin")),pageData["customer-service-button"]&&"1"==pageData["customer-service-button"]&&($(".sys-kefu").addClass("kefu-show"),$("body").append('<script id="GJJCHAT-setjs" src="'+pageData["customer-service-url"]+'" type="text/javascript" charset="utf-8"></script>'))}(),function(e,a,t){"use strict";function s(s,n){var o=""!=n,l=e.getMenuInfo(s),r=l.menuObj,d=l.menuOrder,c=0,u={},m=t.map(d,function(e,a){var s=r[e];u[s.id]=s.name;var l="$$$$$$$$"==s.pid,d="menu-bg"+c%5;l&&c++;var m="",p="";t.each(s.list||[],function(e,a){a.list?p+='<li><span class="menu-group-desc'+(o?"":" hide")+'">'+a.name+'</span><ul class="menulist3">'+t.map(a.list,function(e,a){return"<li><a href = "+i(e.url)+' data-menuid="'+e.id+'">● '+e.name+"</a></li>"}).join("")+"</ul></li>":m+="<li><a href = "+i(a.url)+' data-menuid="'+a.id+'">● '+a.name+"</a></li>"});var h=""==m?"":'<li><span class="menu-group-desc'+(o?"":" hide")+'">'+n+'</span><ul class="menulist3">'+m+"</ul></li>";return l?'<li  class="neck-menu-parent-list '+d+'"><div class="pull-left"><span class="ydico-ish ydico-ish-'+(s.sign||"zcxw")+'"></span><span class="menuname">'+s.name+'</span></div><ul class="pull-left neck-menu-list">'+p+h+"</ul></li>":""}).join("");a.sessionData("menuDescMap",JSON.stringify(u)),t(".neck-menu-main ul").html(m)}function i(e){return e?e=/^(\w+:)?\/\//.test(e)?e:a.contexPath+e:"javascript:void(0);"}function n(e){function s(e){var a=t.map(e,function(e,a){return"<dl><dt>"+e.name+":</dt><dd>"+e.value+"</dd></dl>"}).join("");t(".page-main-user-mes").append(a)}t(".page-main-user-info>div:gt(0)").each(function(a){t(this).text(e.USERINFO[a].info)});var i=a.sessionData("plat_userdata")||{},n=("menu"==poolSelect._TYPE?a.sessionData("plat_curmenuid"):a.attribute.get("_MENUID"))||"";t.isEmptyObject(i)||(i=JSON.parse(i));var o=i[n]||[];s(o)}function o(){var e="/template/ish04/grst/gg/hqycxfk";a.ajax(a.contexPath+e,{poolkey:poolSelect._POOLKEY},function(e){var a=e.ywsj;a.sy&&"1"!=a.sy&&t("#asideHome").addClass("hide"),a.wdzh&&"1"!=a.wdzh?t("#asideAccount").addClass("hide"):(t("#asideAccount > a").attr("href",i(e.wdzhUrl)),t("#myAccount").attr("href",i(e.wdzhUrl)).closest("dd").removeClass("hide")),a.dbrw&&"1"!=a.dbrw&&t("#asideTask").addClass("hide"),a.xx&&"1"!=a.xx&&t("#asidehomeTaskMessage").addClass("hide"),a.ss&&"1"!=a.ss&&t("#asideSearch").addClass("hide"),a.sjkhd&&"1"!=a.sjkhd&&t("#asideShouji").addClass("hide"),a.wxgzh&&"1"!=a.wxgzh&&t("#asideWeixin").addClass("hide"),a.gfwb&&"1"==a.gfwb&&t("#asideWeibo").removeClass("hide");var s=t("#asideMenu");s.removeClass("not-load"),s.find(".aside-mobile li:not(.hide)").length>0&&s.find(".aside-mobile").removeClass("hide");var n=t(".aside-menu-base").height()-42;t(".aside-search-input").css("margin-top",(n-68)/2+"px"),t(".aside-qr").css("margin-top",(n-163)/2+"px")},{silent:!0,error:function(){t("#asideMenu").removeClass("not-load");var e=t(".aside-menu-base").height();t(".aside-search-input").css("margin-top",(e-68)/2+"px")},handleError:function(){t("#asideMenu").removeClass("not-load");var e=t(".aside-menu-base").height();t(".aside-search-input").css("margin-top",(e-68)/2+"px")}}),t("#asideMenu").on("click",".aside-menu-base li",function(){var e=t(this),a=t("#asideMenu .active").not(".aside-main .active"),s=t("#asideMenuMasker");if(e.hasClass("is-parent")&&!e.hasClass("active")?(a.removeClass("active"),s.addClass("hide"),e.addClass("active"),t("#asideMenu .aside-main-base").addClass("active"),t("#"+e.attr("id")+"Main").addClass("active"),s.removeClass("hide")):(a.removeClass("active"),s.addClass("hide")),"asideTask"==e.attr("id")||"asideMessage"==e.attr("id"))return!1}),t("#asideMenuMasker").on("click",function(){t("#asideMenu .active").not(".aside-main .active").removeClass("active"),t("#asideMenuMasker").addClass("hide")})}function l(e){e||(e={});var t=e.operid||poolSelect._OPERID,s=e.poolkey||poolSelect._POOLKEY,i=e.href||"",n=e.funccode||"",o=e.logflag||"menu",l=e.url||"/menulog/insert",r=e.callback;a.ajax(a.contexPath+l,{operid:t,poolkey:s,href:i,funccode:n,logflag:o},function(){r&&r()},{silent:!0}).fail(function(){r&&r()})}t.fn.ydPageBar.setDefaults({theme:"ydpx",totalTemplate:["无查询结果","共 ${totalRows} 条"],infoTemplate:'<input class="form-control yd-pagebar-target" value="${pageNo}"> / ${totalPages}',showPageSize:!1,showGoto:!1}),e.getMenuData=function(e){var t=poolSelect._OPERID,s="sys_menu_"+t,i=a.sessionData(s);i?e&&e(JSON.parse(i)):a.ajax(a.contexPath+"/menuInfo/select",{_POOLKEY:poolSelect._POOLKEY},function(t){a.sessionData(s,JSON.stringify(t)),e&&e(t)})},t(function(){document.title=ydpxData[0].data.page_title,document.getElementById("pageMain").innerHTML=e.renderTabs(ydpxData,pageData,poolSelect),a.flowButtons();for(var s=0;s<ydpxData.length;s++)pageTabs.add(ydpxData[s].data.page_title,ydpxData[s].pageName,document.getElementById("pageTab"+s),ydpxScript[s]);pageTabs[0].open(),a.initContainer(),pageTabs.pageOnload.fire(),t(".compare-container .panel-heading").each(function(){0==t(this).find("span").length&&t(this).html("<span>"+t(this).text()+"</span>")}),e.getMenuData(function(a){e.init(a,pageData.group2Name)}),e.initAttachment((pageData.pageConfig||{}).attachment),e.promptDialog(pageData.message||{}),pageData.pageConfig&&1==pageData.pageConfig.isLeavePrompt?t("body").on("click","a:not(a.no-exit-notice, .modal a, #pageTabs > .nav.nav-tabs a) , #systemExit",function(e){var s=this.href,i=t(this);if(""!=s.trim()&&0!==s.indexOf("javascript:")&&!/^(\w+:)?\/\//.test(i.attr("href"))&&!/^#/.test(i.attr("href"))){e.preventDefault();var n,o,r=$$("b_flow_h");"systemExit"==i.attr("id")?(n="确认退出系统",o="取消退出,确认退出"):(n="确认页面跳转",o="取消跳转,继续跳转"),a.customDialog({title:n,text:"请确认是否要放弃正在编辑的内容，离开当前页面？"+(r?"<br /><br />如果您想保留正在编辑的内容，请先暂存。":""),buttons:o+(r?",暂存并继续":""),callback:function(e){2==e&&t(r).click(),0!=e&&(a.sessionData("plat_curmenuid",i.data("menuid")||""),l({href:s,funccode:i.data("menuid"),callback:function(){a.go(s,"systemExit"==i.attr("id")?top:window)}}))}})}}):t("body").on("click","a:not(a.no-exit-notice, .modal a, #pageTabs > .nav.nav-tabs a) , #systemExit",function(e){var s=this.href,i=t(this);if(""!=s.trim()&&0!==s.indexOf("javascript:")&&!/^#/.test(i.attr("href")))return a.sessionData("plat_curmenuid",i.data("menuid")||""),l({href:s,funccode:i.data("menuid"),callback:function(){a.go(s,"systemExit"==i.attr("id")?top:window)}}),!1}),t("#pageFlowButtons").on("click","button",function(){var e=t(this).attr("id");"b_flow_a"==e?a.sessionData("flowButtonId",e):a.sessionData("flowButtonId","")}),t(document).on("submitSuccess",function(e,t){"b_flow_a"==a.sessionData("flowButtonId")&&(a.sessionData("flowButtonId",""),l({funccode:a.sessionData("plat_curmenuid"),logflag:"sub"}))})}),e.init=function(e){function l(e){if(a.common.isIe&&t("#printFrame").length>0){var s=document.getElementById("printFrame").contentWindow,i=t(s.document.getElementsByTagName("object"));i.length>0&&(e?i.show().removeClass("hide"):i.hide().addClass("hide"))}}if(t(".header-user, #headerUserMasker").click(function(){t(".header-user>dl").is(":hidden")?(t(this).addClass("show").find("i").addClass("names-dim"),t(".header-user>dl").slideDown(),t("#headerUserMasker").removeClass("hide")):(t(".header-user>dl").slideUp(300,function(){t(".header-user").removeClass("show").find("i").removeClass("names-dim")}),t("#headerUserMasker").addClass("hide"))}),t(".neck-menu-btn").on("click",function(){var a=t(".neck-menu").is(":hidden");l(!a),t("#pageMaskLayer").toggleClass("hidden"),0==t(".neck-menu-main ul").children().length&&s(e,pageData.group2Name||""),t(".neck-menu").toggle(500)}),t("#pageMaskLayer").click(function(){t(this).addClass("hidden"),t(".neck-menu").hide(),l(!0)}),t(".neck-menu-foot .glyphicon").click(function(){t("#pageMaskLayer").click()}),t(".neck-menu").on("click","a",function(){var e=t(this).closest(".neck-menu-parent-list").find(".menuname").text(),s=e+" / "+t(this).text().replace("● ","");a.sessionData("plat_curplace",s),a.sessionData("plat_curmenuid",t(this).data("menuid")||"")}),a.attribute.set("_MENUID",a.sessionData("plat_curmenuid")),"menu"==poolSelect._TYPE){var r=a.sessionData("plat_curplace");r&&t(".neck-place").text(r)}else{var d=a.sessionData("menuDescMap")?JSON.parse(a.sessionData("menuDescMap")):{},c=d[a.attribute.get("_MENUID")]||ydpxData[0].data.page_title;t(".neck-place").text(c)}if(e.SEARCH&&t("#search-info").removeClass("hide").attr("action",a.contexPath+e.SEARCH.url).find("input").attr({placeholder:e.SEARCH.placeholder,name:e.SEARCH.name}),n(e),pageData.noticeInfo=pageData.noticeInfo?JSON.parse(pageData.noticeInfo):{},pageData.noticeInfo&&0==pageData.noticeInfo.returnCode){var u=t.map(pageData.noticeInfo.data||[],function(e,a){return"<li>"+(e.url?'<a class="dialog-link dialog-scroll" href="'+e.url+'">'+e.title+"</a>":e.title)+"</li>"}).join("");t("#page_nav_notice div>ul").append(u)}setInterval(function(){var e=t("#page_nav_notice div"),a=e[0].scrollTop+32>=e[0].scrollHeight?0:"+=32";e.animate({scrollTop:a})},3e3),t("a.dialog-link").click(function(){a.displayRunning(!0);var e=t(this).attr("href"),s=new RegExp("^"+a.contexPath);s.test(e)&&(e=e.replace(s,""));var i=t(this).hasClass("dialog-scroll")?{dialogVersion:"scroll"}:{};if(a.subPage(e,i).fail(function(){a.log("获取内容失败"),location.href=a.contexPath+e}).always(function(){a.displayRunning(!1)}),0==t(this).closest("#asideMenu").length)return!1});var m;t("#asideMessage").click(function(){function e(e,s){var r=t.isPlainObject(e),d={messageCount:10},c={msgtype:"messType",readstat:"readState"};t("#msgShowDialog div.filter>div").each(function(){var e=this.className,a=c[e];d[a]=t.map(t(this).find("button.selected"),function(a,s){return t(a).data(e)}).join(",")}),e?d.messageid="":d.messageid=t("#msgShowDialog div.query-result-message:last").data("messageid"),r&&(d=t.extend(d,e)),a.ajax(a.contexPath+"/message/queryMessage",d,function(a,c){var u=l.readstat.dic.read.val,m=l.msgtype.mask,p=t.map(a,function(e,a){var t=e.url&&""!=e.url,s=/^(\w+:)?\/\//.test(e.url)?"_blank":"_self";return'<div data-messageid="'+e.messageid+'" class="query-result-message'+(t?" haslink":"")+(e.stat==u?" read":"")+'"><span class="message-icon '+m[e.type]+'"></span><div><div class="message-head"><span class="message-title">'+e.title+'</span><span class="message-datetime">'+e.time+'</span></div><p class="message-content">'+e.message+"</p></div>"+(t?'<a target="'+s+'" href="'+i(e.url)+'"><span></span>前往查看</a>':"")+"</div>"}).join("");r?(t(".query-result-list").prepend(p),o()):(e?(t(".query-result-list").empty(),""==p?n():t(".query-result-list").append(p)):t(".query-result-list").append(p),a.length<d.messageCount?t("#msgShowDialog div.buttons").hide():t("#msgShowDialog div.buttons").show(),o(),s&&s())})}function s(e){var s=t("#msgShowDialog")[0].clientHeight+e,i=t(".query-term").hasClass("fixed"),n=i?0:t(".query-term").height()+30,o=[],l=[],r=t("#msgShowDialog").data("readmsgid")||[];if(!(r.length>0)&&(t(".query-result-message").each(function(){n=n+this.clientHeight+8;var e=t(this);return n<=s&&void(e.hasClass("read")||(o.push(e.data("messageid")),l.push(e)))}),t("#msgShowDialog").data("readmsgid",o),0!=o.length)){var d=a.contexPath+"/message/"+(o.length>1?"updateMessageList":"updateMessage");a.ajax(d,{messageid:o.join(",")},function(e){t("#msgShowDialog").data("readmsgid",[]),setTimeout(function(){t.each(l,function(e,a){t(a).addClass("read"),t("#asideMessage i.message").removeClass("spanicon")})},3e3)})}}function n(){var e='<div class="empty"><span></span><div>消息记录为空，请查看<span>过滤条件是否均被取消</span>...</div></div>';t(".query-result").addClass("empty"),t(".query-result-list").empty().append(e)}function o(){m=setTimeout("$('#msgDialogBase .modal-dialog').animate({height:$('#msgDialogBase .modal-content').height()+'px'}, 500)",100)}m&&setTimeout(m),a.common.isIe&&t("#printDiv").length>0&&t("#printDiv").hide().addClass("hide");var l=JSON.parse(a.sessionData("msgDic")),r=t.map(l,function(e,a){return'<div data-tip="'+e.desc+'" class="'+a+'">'+t.map(e.dic,function(e,t){return'<button class="'+(e.defaultVal?"selected":"")+'" data-'+a+'="'+e.val+'">'+(e.icon?'<span class="'+e.icon+'"></span>':"")+e.desc+"</button>"}).join("")+"</div>"}).join(""),d='<div class="query-term"><span>消息查询</span><div class="filter"><label><span></span>过滤条件：</label>'+r+"</div></div>",c='<div id="msgShowDialog" class="modal fade in" ><div id="msgDialogBase" class="msgReady">'+d+'<div class="modal-dialog modal-lg"><div class="modal-content"><div class="query-result"><div class="query-result-list"></div><div class="buttons"><button class="btn btn-primary more" type="button">更早信息</button></div></div></div></div></div></div>';t("body").addClass("modal-open").append(c);var u=t("#asideMessage").offset().top,p=t("#asideMessage").offset().left,h=t("#msgDialogBase");if(h.length>0){h.css({top:u,left:p});var g=(document.body.clientWidth-898-17)/2+"px";h.animate({width:"898px",height:"39px",top:"0px",left:g},500,function(){h.removeClass("msgReady").attr("style","")})}e(!0,function(){s(0)}),t("#msgShowDialog").on("click","div.query-term, div.modal-dialog",function(e){e.stopPropagation()}).on("click",".query-term button",function(){var a=t(this).parent();if(!(t(".query-term div.error").length>0)||a.hasClass("error")){if(t(this).hasClass("selected")){if(t(this).removeClass("selected"),0==a.children(".selected").length)return a.addClass("error"),n(),a.tips({key:"key1",type:"error",tip:"提示：请至少选择一种"+a.data("tip")+"！"}),!1}else t(this).addClass("selected"),a.removeClass("error"),t(".query-result").removeClass("empty"),a.data("tip-init")&&a.tips("remove","key1");e(!0)}}).on("click",function(e){t("body").removeClass("modal-open"),t(this).remove(),a.common.isIe&&t("#printDiv").length>0&&t("#printDiv").show().removeClass("hide")}).on("click","button.more",function(){e(!1)}).on("click",".query-term .tip-data a",function(){var a=t(this).data("cnt");e({messageCount:a,readState:"0"}),t(".query-term").data("tip-init")&&t(".query-term").tips("remove","key1"),t("#msgShowDialog").scrollTop(0)}),t("#msgShowDialog").scroll(function(){var e=t(this).scrollTop();e>30?t("#msgShowDialog").addClass("fixed"):t("#msgShowDialog").removeClass("fixed"),s(e)})}),t("#systemExit").click(function(){a.sessionData("pdPreTime",null),a.sessionData("plat_curplace",null),a.sessionData("plat_curmenuid",null),a.sessionData("msgDic",null),a.sessionData("pdPreCounts",null),a.sessionData("percnt",null),a.sessionData("plat_userdata",null),a.sessionData("syscnt",null),a.sessionData("menuDescMap",null),a.sessionData("sys_menu_"+poolSelect._OPERID,null)}),t(".sys-kefu").click(function(){GJJCHAT_SET.GJJ_OPENChat()});var p=pageData.pageConfig&&pageData.pageConfig.flowchart;p&&(t("#pageTabs").before('<div id="pageFlowChart" class="hide"><div></div><i></i></div>'),t("#pageFlowChart div").prepend(a.flowChart(p)).parent().removeClass("hide"),t("#pageFlowChart i").click(function(){t(this).prev().children(".flow-chart").slideToggle(function(){t(this).parent().parent().toggleClass("expand")})})),t("#approve_list").on("show.bs.collapse",function(){t(this).next().html("点击隐藏历史记录")}).on("hide.bs.collapse",function(){t(this).next().html("点击展开 "+t(this).next().data("length")+" 条审批历史记录")}),t(window).resize(function(){try{var e=document.body.clientHeight-t(".header").height()-t(".neck").height()-t(".footer").height();e>455?t("#page_wrap").css("min-height",e):t("#page_wrap").css("min-height","auto")}catch(a){}}).resize(),o()},e.getMenuInfo=function(e){var s={},i={},n=[];return t.each(e.LEFT,function(e,a){n.push(a.id),s[a.id]=a.userinfo||[],"$$$$$$$$"==a.pid?i[a.id]?i[a.id]=t.extend(i[a.id],a):i[a.id]=a:(i[a.pid]?i[a.pid].list?i[a.pid].list.push(a):i[a.pid].list=[a]:i[a.pid]={list:[a]},i[a.id]?i[a.id]=t.extend(i[a.id],a):i[a.id]=a)}),t(".neck-menu").data("menuInfo",i),a.sessionData("plat_userdata",JSON.stringify(s)),{menuObj:i,menuOrder:n}},e.size=function(){},e.initAttachment=function(e){function s(){t("#flowAttachment .nav-tabs").height(t("#flowAttachment .items").height())}if(e&&0!=e.flag){var i=/MSIE 8\.\d/.test(navigator.userAgent),n={};t.each(e.items,function(e,a){n[a.id]=a.groupid});var o=2==e.flag,l="",r=function(t){var s=o;t.rw&&(s="w"==t.rw);var i=s?"textarea":"span",n=e.beanname?"/fileInteractiveFlow/getfile/"+e.beanname:"/attachment/getfile";return'<li data-fid="'+t.fileid+'">'+(s?'<button type="button" class="close" title="删除此附件"><span>&times;</span></button>':"")+'<a class="_'+t.fn.substr(t.fn.lastIndexOf(".")+1||t.fn.length)+'" href="'+a.contexPath+n+"/"+t.fileid+'"></a><p><'+i+' data-original="'+t.remark+'">'+t.remark+"</"+i+"></p></li>"};t("#flowAttachment .nav-tabs").append(t.map(e.items,function(e,a){var s=o;return e.rw&&(s="w"==e.rw),l+='<div id="attachment_item_'+a+'" data-itemid="'+e.id+'" class="tab-pane'+(0===a?" active":"")+'"><ul>'+t.map(e.files,r).join("")+(s?'<li><a class="add" href="#" data-itemid="'+e.id+'"></a><p><span>点击加号添加附件</span></p></li>':"")+"</ul></div>","<li"+(0===a?' class="active"':"")+'><a data-toggle="tab" data-itemid="'+e.id+'" href="#attachment_item_'+a+'"><span>'+(a+1)+". "+e.name+'</span><span class="badge">'+(e.files.length||"")+"</span></a></li>"}).join("")),t("#flowAttachment .tab-content").append(l);var d=t("#flowAttachment").removeClass("hidden");t("#attachment_form input").change(function(){var e=this.files||[{name:this.value}],a=t(this).data("itemid");t("#attachment_form").ajaxSubmit({dataType:"json",async:!0,success:function(o){if(0==o.returnCode){for(var l=t('#flowAttachment .add[data-itemid="'+a+'"]').parent(),c=o.data.length-e.length;c<o.data.length;c++){var u=o.data[c];l.before(r({fn:u.fn,fileid:u.fileid,remark:u.remark}))}n[a]=o.groupId;var m=t('#flowAttachment a[href="#'+l.closest("div").prop("id")+'"] .badge'),p=(parseInt(m.text())||0)+e.length;m.text(p),s(),d.trigger("success.upload",[o,e.length,p,a]),attachment_form.reset(),i&&setFileOff(m)}else d.triggerHandler("error",["upload",o.returnCode,o.message])!==!1&&alert("上传附件出错："+o.message)},error:function(e,a,t){d.triggerHandler("error",["upload",a,t])!==!1&&alert("上传附件出错："+a+" - "+t)}})}),t("#flowAttachment .tab-content").on("click",".add",function(){var s,o=t(this).data("itemid");return s=e.beanname?"/fileInteractiveFlow/upFile/"+e.beanname+"/"+o+"/"+poolSelect._IS+"/"+n[o]:"/attachment/"+poolSelect._IS+"/"+o,t("#attachment_form").prop("action",a.contexPath+s),t("#attachment_form input").data("itemid",o),i||t("#attachment_form input").click(),!1}).on("click","button",function(){if(confirm("请确认是否要删除此附件文件？")){var n=t(this).closest("li"),o=n.closest(".tab-pane").data("itemid"),l=n.data("fid"),r=e.beanname?"/fileInteractiveFlow/delete/"+e.beanname:"/attachment/delete";t.ajax(a.contexPath+r+"/"+l,{method:"GET",dataType:"json",success:function(e){if(0==e.returnCode){var a=t('#flowAttachment a[href="#'+n.closest("div").prop("id")+'"] .badge'),l=parseInt(a.text())-1;a.text(l||""),n.remove(),s(),d.trigger("success.delete",[e,1,l,o]),i&&setFileOff(a)}else d.triggerHandler("error",["delete",e.returnCode,e.message])!==!1&&alert("删除附件出错："+e.message)},error:function(e,a,t){d.triggerHandler("error",["delete",a,t])!==!1&&alert("删除附件出错："+a+" - "+t)}})}}).on("change","textarea",function(){var s=t(this),i=s.closest("li").data("fid"),n=e.beanname?"/fileInteractiveFlow/modi/"+e.beanname:"/attachment/modi";t.ajax(a.contexPath+n+"/"+i,{method:"POST",dataType:"json",data:{remark:this.value},success:function(e){0!=e.returnCode&&(s.val(s.data("original")),alert("修改备注出错："+e.message))},error:function(e,a,t){s.val(s.data("original")),alert("修改备注出错："+a+" - "+t)}})}).on("keydown","textarea",function(e){if(e.which===a.common.keys.Enter||e.which===a.common.keys.Quote)return!1}),s(),d.trigger("load")}},e.promptDialog=function(e){function s(){var e=t("#msgShowDialog").is(":visible"),l={};if(l.isUpdateExptime="no",e){var r=t(".msgtype button.selected").map(function(){return t(this).data("msgtype")}).get().join(",");l.messType=r}a.ajax(i,l,function(i,l){if(0==l.returnCode){var r=i.cnt;if(a.sessionData("pdPreTime",new Date),a.sessionData("pdPreCounts",r),r>0)if(e){t(".query-term").data("tip-init")&&t(".query-term").tips("remove","key1");var c=a.sessionData("percnt")||0,u=a.sessionData("syscnt")||0,m=0;t(".msgtype button.selected").each(function(){"system"==d.msgtype.mask[t(this).data("msgtype")]?m+=i.syscnt-u:"person"==d.msgtype.mask[t(this).data("msgtype")]&&(m+=i.percnt-c)}),m>0&&(t("#msgShowDialog .query-term>div").hasClass("error")||t(".query-term").tips({key:"key1",type:"info",hide:!0,tip:"提示：您收到了"+m+'条新消息！<a data-cnt="'+m+'">前往查看>></a>'}))}else{var p="您收到了新消息<br />共有"+r+"条未读消息",h=250,g=t("#asideMessage").offset();console.log(g);var f=g.left-h,v=g.left-h/2+t("#asideMessage").width()/2+15,y=t('<div class="message-tip" style="left:'+window.innerWidth+'px"><span></span><p>'+p+"</p></div>").appendTo("#page_wrap");t("div.header").addClass("msgshow"),y.animate({left:f,top:g.top,width:h,opacity:1},"slow",function(){t("div.header").removeClass("msgshow")}).delay(1e3*o).animate({left:v+120,top:g.top,width:0,height:"hide"},"300",function(){t(this).remove(),t("#asideMessage i.message").addClass("spanicon")})}a.sessionData("percnt",i.percnt),a.sessionData("syscnt",i.syscnt),0!==n&&n!=-1&&setTimeout(s,1e3*n)}else 0!==n&&n!=-1&&setTimeout(s,1e3*n)})}if(e){var i=a.contexPath+"/message/queryMessageCount",n=e.interval||600,o=e.holdtime||3,l=a.sessionData("pdPreTime"),r=a.sessionData("pdPreCounts")||0;r>0&&t("#asideMessage i.message").addClass("spanicon");var d={msgtype:{desc:"消息类型",dic:{person:{val:"01",desc:"个人消息",icon:"person",defaultVal:!0},system:{val:"00",desc:"系统消息",icon:"system",defaultVal:!0}},mask:{"00":"system","01":"person"}},readstat:{desc:"消息状态",dic:{read:{val:"1",desc:"已读",defaultVal:!0},unread:{val:"0",desc:"未读",defaultVal:!0}},mask:{0:"unread",1:"read"}}};if(a.sessionData("msgDic",JSON.stringify(d)),l){var c=(new Date).getTime()-new Date(l).getTime();c>=1e3*n?s():setTimeout(s,1e3*n-c)}else s()}}}(window.tpl?tpl:window.tpl={},window.ydl?ydl:window.ydl={},jQuery),$(function(){$("#approveList").on("hide.bs.collapse",function(){var e=$(this).next(),a=e.text();e.text(a.replace("收起","展开"))}),$("#approveList").on("show.bs.collapse",function(){var e=$(this).next(),a=e.text();e.text(a.replace("展开","收起"))})});