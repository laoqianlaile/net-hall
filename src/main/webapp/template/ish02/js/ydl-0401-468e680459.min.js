var os=function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),a=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),s=/(?:Firefox)/.test(e),i=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||s&&/(?:Tablet)/.test(e)),o=/(?:iPhone)/.test(e)&&!i,r=!o&&!n&&!a;return{isTablet:i,isPhone:o,isAndroid:n,isPc:r}}();os.isAndroid||os.isPhone?window.top.location.href=$("meta[name=contexPath]").attr("content")+"/common/mobile/app.html":os.isTablet?window.top.location.href=$("meta[name=contexPath]").attr("content")+"/common/mobile/app.html":os.isPc;var poolSelect=pageData.poolSelect||{},userConfig=pageData.userConfig||{},strCertId=pageData.strCertId||"null";!function(){var e="true"==poolSelect._HIDE_PERSON_INFO?"container-fluid userhide":"container-fluid";document.getElementById("page_wrap").setAttribute("class",e),pageData["customer-service-button"]&&"1"==pageData["customer-service-button"]&&($(".sys-kefu").addClass("kefu-show"),$("body").append('<script id="GJJCHAT-setjs" src="'+pageData["customer-service-url"]+'" type="text/javascript" charset="utf-8"></script>'))}(),function(e,t,a){"use strict";a.fn.ydPageBar.setDefaults({theme:"ydpx",totalTemplate:["无查询结果","共 ${totalRows} 条"],infoTemplate:'<input class="form-control yd-pagebar-target" value="${pageNo}"> / ${totalPages}',showPageSize:!1,showGoto:!1}),a(function(){document.title=ydpxData[0].data.page_title,t.isInFrame()&&(top.showThisTab(window.frameElement.id,document.title),t.objectShow(!1)),document.getElementById("pageMain").innerHTML=e.renderTabs(ydpxData,pageData,poolSelect),t.flowButtons();for(var n=0;n<ydpxData.length;n++)pageTabs.add(ydpxData[n].data.page_title,ydpxData[n].pageName,document.getElementById("pageTab"+n),ydpxScript[n]);pageTabs[0].open(),t.initContainer(),pageTabs.pageOnload.fire(),a(".compare-container .panel-heading").each(function(){0==a(this).find("span").length&&a(this).html("<span>"+a(this).text()+"</span>")}),e.initAttachment((pageData.pageConfig||{}).attachment),a(document.documentElement).keydown(function(e){return!(window.top.$("#screenLocker").length>0&&e.which==t.common.keys.F5)&&(e.which==t.common.keys.F5?(top.refreshTab(),!1):void 0)})}),e.init=function(e){a(".sys-kefu").click(function(){GJJCHAT_SET.GJJ_OPENChat()});var n=pageData.pageConfig&&pageData.pageConfig.flowchart;n&&(a("#pageTabs").before('<div id="pageFlowChart" class="hide"><div></div><i></i></div>'),a("#pageFlowChart div").prepend(t.flowChart(n)).parent().removeClass("hide"),a("#pageFlowChart i").click(function(){a(this).prev().children(".flow-chart").slideToggle(function(){a(this).parent().parent().toggleClass("expand")})})),a("#approve_list").on("show.bs.collapse",function(){a(this).next().html("点击隐藏历史记录")}).on("hide.bs.collapse",function(){a(this).next().html("点击展开 "+a(this).next().data("length")+" 条审批历史记录")}),a(window).resize(function(){try{var e=document.body.clientHeight-a(".header").height()-a(".neck").height()-a(".footer").height();e>455?a("#page_wrap").css("min-height",e):a("#page_wrap").css("min-height","auto")}catch(t){}}).resize()},e.size=function(){},e.initAttachment=function(e){function n(){a("#flowAttachment .nav-tabs").height(a("#flowAttachment .items").height())}if(e&&0!=e.flag){var s=/MSIE 8\.\d/.test(navigator.userAgent),i={};a.each(e.items,function(e,t){i[t.id]=t.groupid});var o=2==e.flag,r="",l=function(a){var n=o;a.rw&&(n="w"==a.rw);var s=n?"textarea":"span",i=e.beanname?"/fileInteractiveFlow/getfile/"+e.beanname:"/attachment/getfile";return'<li data-fid="'+a.fileid+'">'+(n?'<button type="button" class="close" title="删除此附件"><span>&times;</span></button>':"")+'<a class="_'+a.fn.substr(a.fn.lastIndexOf(".")+1||a.fn.length)+'" href="'+t.contexPath+i+"/"+a.fileid+'"></a><p><'+s+' data-original="'+a.remark+'">'+a.remark+"</"+s+"></p></li>"};a("#flowAttachment .nav-tabs").append(a.map(e.items,function(e,t){var n=o;return e.rw&&(n="w"==e.rw),r+='<div id="attachment_item_'+t+'" data-itemid="'+e.id+'" class="tab-pane'+(0===t?" active":"")+'"><ul>'+a.map(e.files,l).join("")+(n?'<li><a class="add" href="#" data-itemid="'+e.id+'"></a><p><span>点击加号添加附件</span></p></li>':"")+"</ul></div>","<li"+(0===t?' class="active"':"")+'><a data-toggle="tab" data-itemid="'+e.id+'" href="#attachment_item_'+t+'"><span>'+(t+1)+". "+e.name+'</span><span class="badge">'+(e.files.length||"")+"</span></a></li>"}).join("")),a("#flowAttachment .tab-content").append(r);var d=a("#flowAttachment").removeClass("hidden");a("#attachment_form input").change(function(){var e=this.files||[{name:this.value}],t=a(this).data("itemid");a("#attachment_form").ajaxSubmit({dataType:"json",async:!0,success:function(o){if(0==o.returnCode){for(var r=a('#flowAttachment .add[data-itemid="'+t+'"]').parent(),c=o.data.length-e.length;c<o.data.length;c++){var p=o.data[c];r.before(l({fn:p.fn,fileid:p.fileid,remark:p.remark}))}i[t]=o.groupId;var m=a('#flowAttachment a[href="#'+r.closest("div").prop("id")+'"] .badge'),h=(parseInt(m.text())||0)+e.length;m.text(h),n(),d.trigger("success.upload",[o,e.length,h,t]),attachment_form.reset(),s&&setFileOff(m)}else d.triggerHandler("error",["upload",o.returnCode,o.message])!==!1&&alert("上传附件出错："+o.message)},error:function(e,t,a){d.triggerHandler("error",["upload",t,a])!==!1&&alert("上传附件出错："+t+" - "+a)}})}),a("#flowAttachment .tab-content").on("click",".add",function(){var n,o=a(this).data("itemid");return n=e.beanname?"/fileInteractiveFlow/upFile/"+e.beanname+"/"+o+"/"+poolSelect._IS+"/"+i[o]:"/attachment/"+poolSelect._IS+"/"+o,a("#attachment_form").prop("action",t.contexPath+n),a("#attachment_form input").data("itemid",o),s||a("#attachment_form input").click(),!1}).on("click","button",function(){if(confirm("请确认是否要删除此附件文件？")){var i=a(this).closest("li"),o=i.closest(".tab-pane").data("itemid"),r=i.data("fid"),l=e.beanname?"/fileInteractiveFlow/delete/"+e.beanname:"/attachment/delete";a.ajax(t.contexPath+l+"/"+r,{method:"GET",dataType:"json",success:function(e){if(0==e.returnCode){var t=a('#flowAttachment a[href="#'+i.closest("div").prop("id")+'"] .badge'),r=parseInt(t.text())-1;t.text(r||""),i.remove(),n(),d.trigger("success.delete",[e,1,r,o]),s&&setFileOff(t)}else d.triggerHandler("error",["delete",e.returnCode,e.message])!==!1&&alert("删除附件出错："+e.message)},error:function(e,t,a){d.triggerHandler("error",["delete",t,a])!==!1&&alert("删除附件出错："+t+" - "+a)}})}}).on("change","textarea",function(){var n=a(this),s=n.closest("li").data("fid"),i=e.beanname?"/fileInteractiveFlow/modi/"+e.beanname:"/attachment/modi";a.ajax(t.contexPath+i+"/"+s,{method:"POST",dataType:"json",data:{remark:this.value},success:function(e){0!=e.returnCode&&(n.val(n.data("original")),alert("修改备注出错："+e.message))},error:function(e,t,a){n.val(n.data("original")),alert("修改备注出错："+t+" - "+a)}})}).on("keydown","textarea",function(e){if(e.which===t.common.keys.Enter||e.which===t.common.keys.Quote)return!1}),n(),d.trigger("load")}},e.promptDialog=function(e){function n(){var e=a("#msgShowDialog").is(":visible"),r={};if(e){var l=a(".msgtype button.selected").map(function(){return a(this).data("msgtype")}).get().join(",");r.messType=l}t.ajax(s,r,function(s,r){if(0==r.returnCode){var l=s.cnt;if(t.sessionData("pdPreTime",new Date),t.sessionData("pdPreCounts",l),l>0)if(e){a(".query-term").data("tip-init")&&a(".query-term").tips("remove","key1");var c=t.sessionData("percnt")||0,p=t.sessionData("syscnt")||0,m=0;a(".msgtype button.selected").each(function(){"system"==d.msgtype.mask[a(this).data("msgtype")]?m+=s.syscnt-p:"person"==d.msgtype.mask[a(this).data("msgtype")]&&(m+=s.percnt-c)}),m>0&&(a("#msgShowDialog .query-term>div").hasClass("error")||a(".query-term").tips({key:"key1",type:"info",hide:!0,tip:"提示：您收到了"+m+'条新消息！<a data-cnt="'+m+'">前往查看>></a>'}))}else{var h="您收到了新消息<br />共有"+l+"条未读消息",f=250,g=a("#sysMessage").offset(),u=g.left-f/2+a("#sysMessage").width()/2,v=a('<div class="message-tip" style=""><span></span><p>'+h+"</p></div>").appendTo("div.header");a("div.header").addClass("msgshow"),v.animate({left:u,width:f,opacity:1},"slow",function(){a("div.header").removeClass("msgshow")}).delay(1e3*o).animate({left:u+120,top:g.top-4,width:0,height:"hide"},"300",function(){a(this).remove(),a("#sysMessage i.message").addClass("spanicon")})}t.sessionData("percnt",s.percnt),t.sessionData("syscnt",s.syscnt),0!==i&&i!=-1&&setTimeout(n,1e3*i)}else 0!==i&&i!=-1&&setTimeout(n,1e3*i)})}if(e){var s=t.contexPath+"/message/queryMessageCount",i=e.interval||600,o=e.holdtime||3,r=t.sessionData("pdPreTime"),l=t.sessionData("pdPreCounts")||0;l>0&&a("#sysMessage i.message").addClass("spanicon");var d={msgtype:{desc:"消息类型",dic:{person:{val:"01",desc:"个人消息",icon:"person",defaultVal:!0},system:{val:"00",desc:"系统消息",icon:"system",defaultVal:!0}},mask:{"00":"system","01":"person"}},readstat:{desc:"消息状态",dic:{read:{val:"1",desc:"已读",defaultVal:!0},unread:{val:"0",desc:"未读",defaultVal:!0}},mask:{0:"unread",1:"read"}}};if(t.sessionData("msgDic",JSON.stringify(d)),r){var c=(new Date).getTime()-new Date(r).getTime();c>=1e3*i?n():setTimeout(n,1e3*i-c)}else n()}}}(window.tpl?tpl:window.tpl={},window.ydl?ydl:window.ydl={},jQuery),$(function(){$("#approveList").on("hide.bs.collapse",function(){var e=$(this).next(),t=e.text();e.text(t.replace("收起","展开"))}),$("#approveList").on("show.bs.collapse",function(){var e=$(this).next(),t=e.text();e.text(t.replace("展开","收起"))})});